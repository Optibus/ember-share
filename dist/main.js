(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function i(e){return{newPos:e.newPos,components:e.components.slice(0)}}e.r(t),e.d(t,{Hg:()=>s,M8:()=>n,_X:()=>o});const r=function(e){this.ignoreWhitespace=e};function o(){const e={};e[window.Primus.CLOSED]="disconnected",e[window.Primus.OPENING]="connecting",e[window.Primus.OPEN]="connected",window.sharedb.Connection.prototype.bindToSocket=function(t){const n=this;function i(t){const i=e[t];n._setState(i)}this.state=0===t.readyState||1===t.readyState?"connecting":"disconnected",i(Primus.OPENING),i(t.readyState),this.canSend="connected"===this.state,this.socket={send(e){t.write(e)}},t.on("data",(function(e){if(e.a)try{n.handleMessage(e)}catch(e){throw n.emit("error",e),e}})),t.on("readyStateChange",(function(){i(t.readyState)})),t.on("reconnecting",(function(){"disconnected"===n.state&&(i(Primus.OPENING),n.canSend=!1)}))}}r.prototype={diff(e,t){if(t===e)return[{value:t}];if(!t)return[{value:e,removed:!0}];if(!e)return[{value:t,added:!0}];t=this.tokenize(t),e=this.tokenize(e);const n=t.length,r=e.length,o=n+r,s=[{newPos:-1,components:[]}];let c=this.extractCommon(s[0],t,e,0);if(s[0].newPos+1>=n&&c+1>=r)return s[0].components;for(let l=1;l<=o;l++)for(let o=-1*l;o<=l;o+=2){var h;const l=s[o-1],u=s[o+1];c=(u?u.newPos:0)-o,l&&(s[o-1]=void 0);const a=l&&l.newPos+1<n,d=u&&c>=0&&c<r;if(a||d){if(!a||d&&l.newPos<u.newPos?(h=i(u),this.pushComponent(h.components,e[c],void 0,!0)):((h=i(l)).newPos++,this.pushComponent(h.components,t[h.newPos],!0,void 0)),c=this.extractCommon(h,t,e,o),h.newPos+1>=n&&c+1>=r)return h.components;s[o]=h}else s[o]=void 0}},pushComponent(e,t,n,i){const r=e[e.length-1];r&&r.added===n&&r.removed===i?e[e.length-1]={value:this.join(r.value,t),added:n,removed:i}:e.push({value:t,added:n,removed:i})},extractCommon(e,t,n,i){const r=t.length,o=n.length;let{newPos:s}=e,c=s-i;for(;s+1<r&&c+1<o&&this.equals(t[s+1],n[c+1]);)s++,c++,this.pushComponent(e.components,t[s],void 0,void 0);return e.newPos=s,c},equals(e,t){const n=/\S/;return!(!this.ignoreWhitespace||n.test(e)||n.test(t))||e===t},join:(e,t)=>e+t,tokenize:e=>e},Array.isArray;const s=new r(!1);function c(e){return{isOpOnArray:e=>null!=e.ld||null!=e.lm||null!=e.li,matchingPaths(e,t){let n=0;const i=e.length>t.length?e.length:t.length;for(;("*"==e[n]||e[n]==t[n])&&n<i;)n+=1;return n-e.length/1e3},matchChildToLimitations(t){const n=Ember.get(e,"_root._childLimiations");let i=Ember.get(e,"_prefix");null==i||t.match(i)?i=t:i+=`.${t}`,i=i.split(".");const r=this;return _.some(n,(e=>{const t=e.split("/");return i.length==t.length&&Math.ceil(r.matchingPaths(t,i))==i.length}))},prefixToChildLimiations(t){const n=Ember.get(e,"_root._childLimiations");let i=Ember.get(e,"_prefix");null==i||t.match(i)?i=t:i+=`.${t}`,i=i.split(".");const r=this;let o;const s=this.findMaxIndex(o=_.map(n,(e=>{const t=e.split("/"),n=Math.ceil(r.matchingPaths(t,i));return n<t.length?0:n})));if(s>=0&&o[s]>0){const t=n[s].split("/");let o;const c=i.slice(0,Math.ceil(r.matchingPaths(t,i)));return(o=Ember.get(e,"_prefix"))?(o=o.split("."),c.slice(o.length).join(".")):c.join(".")}return t},removeChildren(t,n){const i=Ember.get(e,"_children");let r=Object.keys(i);const o=e.get("_prefix");null!=o&&t&&0!=t.indexOf(o)&&(t=`${o}.${t}`),t&&(r=_.reduce(r,((e,i)=>(i==t?n&&e.push(i):0==i.indexOf(t)&&e.push(i),e)),[])),_.forEach(r,(e=>{i[e].removeListeners(),i[e].destroy(),delete i[e]}))},comparePathToPrefix(e,t){return Boolean(Math.ceil(this.matchingPaths(e.split("."),t.split("."))))},cutLast(e,t){let n;return this.isOpOnArray(t)&&!isNaN(+_.last(e))&&(n=_.clone(e),n.pop()),n||e},comparePathToChildren(t,n){const i=this,r=Ember.get(e,"_children"),o=Object.keys(r),s=_.some(o,(e=>{const r=i.matchingPaths(e.split("."),i.cutLast(t,n));return Math.ceil(r)==e.split(".").length}));return!Ember.isEmpty(o)&&s},triggerChildren(t,n,i){_.clone(n.p);const r=e.get("_children"),o=Object.keys(r);if(Ember.isEmpty(o))return;const s=this,c=_.mapKeys(r,((e,t)=>s.isOpOnArray(n)&&!isNaN(+_.last(t.split(".")))?0:s.matchingPaths(s.cutLast(t.split("."),n),s.cutLast(n.p,n)))),h=c[_.max((l=Object.keys(c),_.map(l,(e=>+e))))];var l;"Will"==t&&h.trigger("before op",[n],i),"Did"==t&&h.trigger("op",[n],i)},beforeAfter(t){const n=this;let i;return function(r,o){o||_.forEach(r,(r=>{n.comparePathToChildren(r.p,r)?n.triggerChildren(t,r,o):n.isOpOnArray(r)?(i=n.extractArrayPath(r),e.get(i.p)[`arrayContent${t}Change`](i.idx,i.removeAmt,i.addAmt)):e[`property${t}Change`](n.prefixToChildLimiations(r.p.join(".")))}))}},beforeAfterChild(t){const n=this;let i,r,o;return function(s,c){null==(o=Ember.get(e,"_idx"))&&c||_.forEach(s,(s=>{if(s.p.join(".")==(r=Ember.get(e,"_prefix"))&&"Did"==t){if(null!=s.oi){const t=e.get(`_root.doc.data.${r}`);e.replaceContent(t,!0)}else if(null!=s.od){const t=r.split("."),n=t.pop();!_.isEmpty(t)&&(h=e.get(`_children.${t.join(".")}`))?h.removeKey(n):e.get("_root").propertyDidChange(r)}}else{const l=null==o?r.split("."):r.split(".").concat(String(o)),u=_.difference(s.p,l);if(n.comparePathToPrefix(s.p.join("."),r))if(n.isOpOnArray(s)&&null==Ember.get(e,"_idx")){var c=_.clone(s);c.p=u,i=n.extractArrayPath(c),""==i.p?e[`arrayContent${t}Change`](i.idx,i.removeAmt,i.addAmt):Ember.get(e,i.p)[`arrayContent${t}Change`](i.idx,i.removeAmt,i.addAmt)}else if(""==u.join(".")){if(_.isEmpty(c)&&s.od&&null==s.oi&&_.isEqual(s.od,e.toJson())){const t=l.pop();var h;_.isEmpty(l)?n.removeChildren(t,!0):(h=e.get("_children")[l.join(".")]).removeKey(t)}}else s.oi&&null==s.od&&e.addKey(_.head(u)),s.od&&null==s.oi?(e.notifyPropertyChange(n.prefixToChildLimiations(u.join("."))),1===u.length&&e.removeKey(_.head(u))):e[`property${t}Change`](n.prefixToChildLimiations(u.join(".")))}}))}},findMaxIndex:e=>e.indexOf(_.max(e)),extractArrayPath:e=>({idx:+_.last(e.p),p:_.slice(e.p,0,e.p.length-1).join("."),addAmt:void 0!==e.li?1:0,removeAmt:void 0!==e.ld?1:0})}}Ember.Mixin.create({textKeys:[],triggerEvents:!1,textEvents:function(){this._textContexts=new Array(this.textKeys.length),this._handlers=new Array(2*this._textContexts.length);for(let e=0;e<this.textKeys.length;e++){const t=this.textKeys[e],n=this._context.createContextAt([t]);this._handlers[t]=new Array(2),this._handlers[t].push(n.on("insert",Ember.run.bind(this,this.handleInsert,t))),this._handlers[t].push(n.on("delete",Ember.run.bind(this,this.handleDelete,t))),this._textContexts[t]=n}}.on("init"),setUnknownProperty(e,t){this.textKeys.indexOf(e)>=0?this.textOp(e,t):this._super(e,t)},textOp(e,t){if(void 0===this._context.get())return;this.propertyWillChange(e);const n=s.diff(this._cache[e]||"",t.replace(/\r\n/g,"\n"));this._cache[e]=t.replace(/\r\n/g,"\n");let i=0;for(let t=0;t<n.length;t++)n[t].added?this._context.insert([e,i],n[t].value):n[t].removed&&this._context.remove([e,i],n[t].value.length),i+=n[t].value.length;this.propertyDidChange(e)},handleInsert(e,t,n){this.propertyWillChange(e),void 0===this._cache[e]&&this.get(e);const i=this._cache[e].slice(0,t)+n+this._cache[e].slice(t);this._cache[e]=i,this.triggerEvents&&this.trigger("textInsert",t,n),this.propertyDidChange(e)},handleDelete(e,t,n){void 0===this._cache[e]&&this.get(e),this.propertyWillChange(e);const{length:i}=n,r=this._cache[e].slice(0,t)+this._cache[e].slice(t+i);this._cache[e]=r,this.triggerEvents&&this.trigger("textDelete",t,n),this.propertyDidChange(e)},willDestroy(){for(const e in this._textContexts)this._textContexts[e].removeListener(this._handlers[e][0]),this._textContexts[e].removeListener(this._handlers[e][1]),this._textContexts[e].destroy();this._super()}});const h={object:{},array:{}},l=Ember.Mixin.create({useSubs:function(e,t,n){if(c(this).matchChildToLimitations(t))return e;if(_.isPlainObject(e)){e={tempContent:e};var i="object"}else _.isArray(e)&&(e={content:e},i="array");if(i){let r,o;const s=null==n?t:`${t}.${n}`;let c=Ember.get(this,"_prefix");if(null!=(o=Ember.get(this,"_idx"))&&(c+=`.${o}`),s==c)return this;const l=Ember.get(this,"_children"),u=Object.keys(l);if(_.includes(u,s))return l[s];r={};let a=h[i].extend({_children:Ember.get(this,"_children"),_prefix:t,_idx:n,_sdbProps:Ember.get(this,"_sdbProps"),_root:Ember.get(this,"_root")});return a=a.create(e),r[s]=a,_.assign(Ember.get(this,"_children"),r),a}return e}}),u=function(e){return e};function a(e){return function(){let t,n;if(t={},n=null,_.forEach(arguments,(function(e){return _.isPlainObject(e)?t=e:_.isString(e)?n=e.charAt(0).toUpperCase()+e.slice(1):void 0})),null!=n&&null!=window[n])var i=function(e){const t=new window[n](e);return"Date"==n?t:t.valueOf()};else i=u;return Ember.computed({get(t){return this.get(e,!0).addObject(t),_.includes(["_isSDB","_sdbProps","_subProps","doc","_prefix","content","_idx","_root"],t)||null==this._fullPath?i(this._get(t,!0)):i(this._get(this._fullPath(t)))},set(e,t,n){const i=null==e?this.get("_prefix"):"_idx"!=e&&this._fullPath?this._fullPath(e):e;return this._set(i,t)}})}}const d=Ember.Mixin.create({_children:function(){return{}}.property(),_sdbProps:function(){return[]}.property(),_subProps:function(){return[]}.property(),doc:Ember.computed.reads("_root.doc"),createInnerAttrs:function(){const e=Ember.get(this,"tempContent"),t=this,n=a("_subProps"),i=[];_.forEach(e,(function(e,r){i.push(r),Ember.defineProperty(t,r,n())})),Ember.get(this,"_subProps").addObjects(i),delete this.tempContent}.on("init"),beforeFn:function(){return[]}.property(),afterFn:function(){return[]}.property(),activateListeners:function(){const e=c(this),t=e.beforeAfterChild("Will"),n=e.beforeAfterChild("Did");this.removeListeners(),this.on("before op",t),this.on("op",n),this.get("beforeFn").push(t),this.get("afterFn").push(n)}.observes("doc").on("init"),_fullPath(e){const t=Ember.get(this,"_prefix"),n=Ember.get(this,"_idx");return t?null!=n?`${t}.${n}.${e}`:`${t}.${e}`:e},deleteProperty(e){const t=this._super(this._fullPath(e));return this.removeKey(e),t},replaceContent(e,t){this.notifyWillProperties(this.get("_subProps").toArray());const n=this.get("_prefix"),i=this.get("_idx"),r=null==i?n:`${n}.${i}`;t||this._set(r,e);const o=this;if(c(this).removeChildren(r),_.isEmpty(Object.keys(this))){Ember.setProperties(this,{tempContent:e}),this.createInnerAttrs();var s=function(e,t){if(_.isEmpty(e))o.get("_root").notifyPropertyChange(t.join("."));else{const n=o.get._children[e.join(".")];null!=n?n.notifyPropertyChange(`${e.join(".")}.${t.join(".")}`):t.push(e.pop()),s(e,t)}};const t=n.split("."),i=t.pop();s(t,[i])}else{if(_.isPlainObject(e))var h=_.difference(Object.keys(this),Object.keys(e));else h=Object.keys(this);_.forEach(h,(function(e){delete o[e]})),this.get("_subProps").removeObjects(h),Ember.setProperties(this,{tempContent:e}),this.createInnerAttrs(),this.notifyDidProperties(this.get("_subProps").toArray())}return this},toJson(){const e=Ember.get(this,"_idx"),t=Ember.get(this,"_prefix"),n=null==e?t:`${t}.${e}`;return this.get(`doc.data.${n}`)},addKey(e){const t=a("_subProps");return this.get("_subProps").indexOf(e)>-1||Ember.defineProperty(this,e,t()),this},removeKey(e){return a("_subProps"),c(this).removeChildren(e,!0),this.get("_subProps").removeObject(e),delete this[e],this},removeListeners(){this.has("before op")&&this.off("before op",this.get("beforeFn").pop()),this.has("op")&&this.off("op",this.get("afterFn").pop())}}),p=function(e){return e.slice(0,e.length-1)},f=function(e){return null!=e&&"string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e?"function"==typeof e.toJson?e.toJson():null==(t=e)?void 0:JSON.parse(JSON.stringify(t)):e;var t},g=Ember.Mixin.create({_get(e,t){const n=_.head(e.split("."));if("_sdbProps"!=e&&_.includes(this.get("_sdbProps"),n)){const t=this.get(`doc.data.${e}`);return this.useSubs(t,e)}return this.get(e)},_set(e,t){const n=_.first(e.split(".")),i=this;if(null==Ember.get(this,"_prefix")&&this.get(n),"_sdbProps"!=e&&_.includes(this.get("_sdbProps"),n)){const n=f(this._get(e));t=f(t);const r=e.split(".");c(this).removeChildren(e,!0);const o={p:r,od:n,oi:t};return null==n&&delete o.od,o.oi!=o.od&&this.get("doc").submitOp([o],(function(e){i.get("_root",!0).trigger("submitted",e)})),this.useSubs(t,e)}return this.set(e,t,!0)}});let m=Ember.Object.extend(Ember.Evented,g,{_isSDB:!0,notifyProperties:function(e){const t=this;return _.forEach(e,(function(e){t.notifyPropertyChange(e)})),this},notifyDidProperties:function(e){const t=this;return _.forEach(e,(function(e){t.propertyDidChange(e)})),this},notifyWillProperties:function(e){const t=this;return _.forEach(e,(function(e){t.propertyWillChange(e)})),this},deleteProperty:function(e){const t=this.get("doc"),n=e.split("."),i=f(this.get(`_root.${e}`));t.submitOp([{p:n,od:i}])},setProperties:function(e){const t=this.get("_sdbProps"),n=this,i=_.filter(_.keys(e),(function(e){return n.get(e),_.includes(t,e)})),r=_.reject(_.keys(e),(function(e){return _.includes(t,e)}));return this._super(_.pick(e,r)),_.forEach(i,(function(t){n.set(t,e[t])})),this}});m=m.extend(l),h.object=m.extend(d),h.array=function(e,t){return Ember.ArrayProxy.extend(Ember.Evented,e,t,{_isArrayProxy:!0,arrayContentDidChange(e,t,n){return(null==t?0:-1*t)+(null==n)||!n||Ember.get(this,"content").propertyDidChange("lastObject"),this._super.apply(this,arguments)},arrayContentWillChange(e,t,n){const i=Ember.get(this,"_children"),r=Object.keys(i),o=Ember.get(this,"_prefix"),s=this,h=c(this),l=function(e,t){return`${p(e.split(".")).join(".")}.${t}`},u=null==t?0:-1*t;u+(n=null==n?0:n)&&Ember.get(this,"content").propertyWillChange("lastObject");const a=_.reduce(r,(function(e,t){return p(t.split(".")).join(".")==o&&e.push(t),e}),[]);return _.forEach(a,(function(o){const c=+_.last(o.split("."));if(!isNaN(c)){const a=i[o];if(u+n==0)c>=n&&(h.removeChildren(o,!0),Ember.get(s,"content").propertyWillChange("lastObject"));else if(n&&e<=c||t&&e<c){const e=c+u+n,t=l(o,e);r.filter((function(e){return e.match(new RegExp(`^${o}\\.`))})).forEach((function(e){const n=i[e],r=e.replace(new RegExp(`^${o}`),t);n.set("_prefix",r),delete i[e],i[r]=n})),delete i[o];const s={};s[l(o,e)]=a,_.assign(i,s),Ember.set(a,"_idx",e)}}})),this._super.apply(this,arguments)},replaceContent(e,t){const n=Ember.get(this,"_prefix"),i=Ember.get(this,"_children");return _.forEach(this.toArray(),(function(t,r){const o=i[`${n}.${r}`];null!=o&&(null!=e[r]?o.replaceContent(e[r],!0):(delete i[`${n}.${r}`],o.destroy()))})),t||this._set(n,e),Ember.set(this,"content",e),this},_submitOp(e,t,n){const i={p:this.get("_prefix").split(".").concat(e)};if(void 0!==t&&(i.li=t),void 0!==n&&(i.ld=n),null!=t||null!=n)return this.get("doc").submitOp([i])},objectAt(e){const t=this._super(e),n=this.get("_prefix");return this.useSubs(t,n,e)},toJson(){return _.map(this.toArray(),(function(e){return"string"==typeof e||"number"==typeof e?e:e.toJson()}))},_replace(e,t,n){_.isArray(n)||(n=[n]),this.arrayContentWillChange(e,t,n.length);const i=t>n.length?t:n.length;for(let r=0;r<i;r++){const i=r+e;let o=n.objectAt(r);null!=o&&(o=null==o.toJson?o:o.toJson());let s=this.objectAt(i);null!=s&&(s=null==s.toJson?s:s.toJson()),this._submitOp(i,o,t>r?s:void 0)}this.arrayContentDidChange(e,t,n.length);const r=this.get(`doc.data.${this.get("_prefix")}`);return _.isEqual(this.get("content"),r)||this.onChangeDoc(),this},onChangeDoc:function(){this.replaceContent(this.get(`doc.data.${this.get("_prefix")}`),!0)}.observes("doc")})}(d,g).extend(l),m.extend({unload(){return this.get("_store").unload(this.get("_type"),this)},id:Ember.computed.reads("doc.id"),_childLimiations:function(){return[]}.property(),_root:function(){return this}.property(),_children:function(){return{}}.property(),_sdbProps:function(){return[]}.property(),setOpsInit:function(){const e=this.get("doc",!0),t=this.get("oldDoc"),n=c(this);t&&t.destroy(),TEST_ENV?(e.on("before op",n.beforeAfter("Will")),e.on("op",n.beforeAfter("Did"))):(e.on("before component",n.beforeAfter("Will")),e.on("after component",n.beforeAfter("Did"))),this.set("oldDoc",e)}.observes("doc").on("init"),willDestroy(){this.get("doc")&&this.get("doc").destroy((()=>{const e=c(this);this._super.apply(this,arguments),e.removeChildren()}))}});const b={plurals:[[/$/,"s"],[/s$/i,"s"],[/^(ax|test)is$/i,"$1es"],[/(octop|vir)us$/i,"$1i"],[/(octop|vir)i$/i,"$1i"],[/(alias|status|bonus)$/i,"$1es"],[/(bu)s$/i,"$1ses"],[/(buffal|tomat)o$/i,"$1oes"],[/([ti])um$/i,"$1a"],[/([ti])a$/i,"$1a"],[/sis$/i,"ses"],[/(?:([^f])fe|([lr])f)$/i,"$1$2ves"],[/(hive)$/i,"$1s"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/(x|ch|ss|sh)$/i,"$1es"],[/(matr|vert|ind)(?:ix|ex)$/i,"$1ices"],[/^(m|l)ouse$/i,"$1ice"],[/^(m|l)ice$/i,"$1ice"],[/^(ox)$/i,"$1en"],[/^(oxen)$/i,"$1"],[/(quiz)$/i,"$1zes"]],singular:[[/s$/i,""],[/(ss)$/i,"$1"],[/(n)ews$/i,"$1ews"],[/([ti])a$/i,"$1um"],[/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)(sis|ses)$/i,"$1sis"],[/(^analy)(sis|ses)$/i,"$1sis"],[/([^f])ves$/i,"$1fe"],[/(hive)s$/i,"$1"],[/(tive)s$/i,"$1"],[/([lr])ves$/i,"$1f"],[/([^aeiouy]|qu)ies$/i,"$1y"],[/(s)eries$/i,"$1eries"],[/(m)ovies$/i,"$1ovie"],[/(x|ch|ss|sh)es$/i,"$1"],[/^(m|l)ice$/i,"$1ouse"],[/(bus)(es)?$/i,"$1"],[/(o)es$/i,"$1"],[/(shoe)s$/i,"$1"],[/(cris|test)(is|es)$/i,"$1is"],[/^(a)x[ie]s$/i,"$1xis"],[/(octop|vir)(us|i)$/i,"$1us"],[/(alias|status|bonus)(es)?$/i,"$1"],[/^(ox)en/i,"$1"],[/(vert|ind)ices$/i,"$1ex"],[/(matr)ices$/i,"$1ix"],[/(quiz)zes$/i,"$1"],[/(database)s$/i,"$1"]],irregularPairs:[["person","people"],["man","men"],["child","children"],["sex","sexes"],["move","moves"],["cow","kine"],["zombie","zombies"]],uncountable:["equipment","information","rice","money","species","series","fish","sheep","jeans","police"]},{capitalize:y}=_,x=/^\s*$/,$=/([\w/-]+[_/\s-])([a-z\d]+$)/,C=/([\w/\s-]+)([A-Z][a-z\d]*$)/,E=/[A-Z][a-z\d]*$/;function v(e,t){for(let n=0,{length:i}=t;n<i;n++)e.uncountable[t[n].toLowerCase()]=!0}function P(e,t){let n;for(let i=0,{length:r}=t;i<r;i++)n=t[i],e.irregular[n[0].toLowerCase()]=n[1],e.irregular[n[1].toLowerCase()]=n[1],e.irregularInverse[n[1].toLowerCase()]=n[0],e.irregularInverse[n[0].toLowerCase()]=n[0]}function w(e){(e=e||{}).uncountable=e.uncountable||O(),e.irregularPairs=e.irregularPairs||O();const t=this.rules={plurals:e.plurals||[],singular:e.singular||[],irregular:O(),irregularInverse:O(),uncountable:O()};v(t,e.uncountable),P(t,e.irregularPairs),this.enableCache()}if(!Object.create&&!Object.create(null).hasOwnProperty)throw new Error("This browser does not support Object.create(null), please polyfil with es5-sham: http://git.io/yBU2rg");function O(){const e=Object.create(null);return e._dict=null,delete e._dict,e}w.prototype={enableCache(){this.purgeCache(),this.singularize=function(e){return this._cacheUsed=!0,this._sCache[e]||(this._sCache[e]=this._singularize(e))},this.pluralize=function(e,t,n={}){this._cacheUsed=!0;const i=[e,t,n.withoutCount];return this._pCache[i]||(this._pCache[i]=this._pluralize(e,t,n))}},purgeCache(){this._cacheUsed=!1,this._sCache=O(),this._pCache=O()},disableCache(){this._sCache=null,this._pCache=null,this.singularize=function(e){return this._singularize(e)},this.pluralize=function(){return this._pluralize(...arguments)}},plural(e,t){this._cacheUsed&&this.purgeCache(),this.rules.plurals.push([e,t.toLowerCase()])},singular(e,t){this._cacheUsed&&this.purgeCache(),this.rules.singular.push([e,t.toLowerCase()])},uncountable(e){this._cacheUsed&&this.purgeCache(),v(this.rules,[e.toLowerCase()])},irregular(e,t){this._cacheUsed&&this.purgeCache(),P(this.rules,[[e,t]])},pluralize(){return this._pluralize(...arguments)},_pluralize(e,t,n={}){return void 0===t?this.inflect(e,this.rules.plurals,this.rules.irregular):(1!==parseFloat(e)&&(t=this.inflect(t,this.rules.plurals,this.rules.irregular)),n.withoutCount?t:`${e} ${t}`)},singularize(e){return this._singularize(e)},_singularize(e){return this.inflect(e,this.rules.singular,this.rules.irregularInverse)},inflect(e,t,n){let i,r,o,s,c,h,l,u,a,d;if(l=!e||x.test(e),u=E.test(e),l)return e;if(s=e.toLowerCase(),c=$.exec(e)||C.exec(e),c&&(h=c[2].toLowerCase()),d=this.rules.uncountable[s]||this.rules.uncountable[h],d)return e;for(a in n)if(s.match(`${a}$`))return r=n[a],u&&n[h]&&(r=y(r),a=y(a)),e.replace(new RegExp(a,"i"),r);for(let n=t.length,r=0;n>r&&(i=t[n-1],a=i[0],!a.test(e));n--);return i=i||[],a=i[0],r=i[1],o=e.replace(a,r),o}},w.defaultRules=b,w.inflector=new w(b);const j=w.inflector;let{singularize:A,pluralize:k}=j;A=A.bind(j),k=k.bind(j);const{Promise:S}=Ember.RSVP,z=Ember.ObjectProxy.extend(Ember.PromiseProxyMixin),L=(Ember.Object.extend(Ember.Evented,{socket:null,connection:null,url:window.location.hostname,init(){const e=this;if(this.checkSocket=function(){return new S((function(t,n){if(null==e.socket)e.one("connectionOpen",t);else{const i=function(n,i){switch(n){case"connected":return t();case"connecting":return e.connection.once("connected",t);default:i(n)}},r=function(e){switch(e){case"closed":return n("connection closed");case"disconnected":return n("connection disconnected");case"stopped":return n("connection closing")}};let o=!1;i(e.connection.state,(function(t){o?r(t):Ember.run.next(this,(function(){o=!0,i(e.connection.state,r)}))}))}}))},this.checkConnection=function(){return new S((function(t,n){return e.checkSocket().then((function(){return t()})).catch((function(e){return n(e)}))}))},this.cache={},!window.sharedb)throw new Error("sharedb client not included");if(void 0===window.BCSocket&&void 0===window.Primus)throw new Error("No Socket library included");this.beforeConnect?this.beforeConnect().then((function(){e.trigger("connect")})):e.trigger("connect")},doConnect:function(e){const t=this;if(window.BCSocket)this.setProperties(e),this.socket=new BCSocket(this.get("url"),{reconnect:!0}),this.socket.onerror=function(e){t.trigger("connectionError",[e])},this.socket.onopen=function(){t.trigger("connectionOpen")},this.socket.onclose=function(){t.trigger("connectionEnd")};else{if(!window.Primus)throw new Error("No Socket library included");{o(),this.setProperties(e);let n=this.get("url");this.get("protocol")&&(n=`${this.get("protocol")}://${n}`),this.get("port")?n+=`:${this.get("port")}`:n+=":80",this.socket=new Primus(n,e),this.socket.on("error",(function(e){t.trigger("connectionError",[e])})),this.socket.on("open",(function(){t.trigger("connectionOpen")})),this.socket.on("end",(function(){t.trigger("connectionEnd")})),this.socket.on("close",(function(){t.trigger("connectionEnd")}))}}const n=sharedb.Connection.prototype.handleMessage;sharedb.Connection.prototype.send,t.on("connectionEnd",(function(){t.isAuthenticated=!1})),sharedb.Connection.prototype.handleMessage=function(e){let i;i=arguments;const r=this;if(n.apply(r,i),"init"===e.a&&"string"==typeof e.id&&1===e.protocol&&"function"==typeof t.authenticate)return t.isAuthenticating=!0,t.authenticate(e.id).then((function(){console.log("authenticated !"),t.isAuthenticating=!1,t.isAuthenticated=!0,n.apply(r,i),t.trigger("authenticated")})).catch((function(e){t.isAuthenticating=!1}))},this.connection=new sharedb.Connection(this.socket)}.on("connect"),find(e,t){e=k(e);const n=this;return this.checkConnection().then((function(){return n.findQuery(e,{_id:t}).then((function(e){return e[0]}),(function(e){return e}))}))},createRecord(e,t){let i,r;r=(i=this._getPathForType(e))?i:e.pluralize(),r=this._getPrefix(e)+r,e=k(e);const o=this;return o.checkConnection().then((function(){const i=o.connection.get(r,null==t.id?n():t.id);return S.all([o.whenReady(i).then((function(e){return o.create(e,t)})),o.subscribe(i)]).then((function(){const t=o._createModel(e,i);return o._cacheFor(e).addObject(t),t}))}))},deleteRecord(e,t){const n=this._cacheFor(k(e)).findBy("id",t).get("doc");return new S((function(e,t){n.del((function(n){null!=n?t(n):e()}))}))},findAndSubscribeQuery(e,t){e=k(e);const n=this,i=this._getPrefix(e);return this.checkConnection().then((function(){return new S((function(r,o){let s,c;c=n.connection.createSubscribeQuery(i+e,t,null,(function(t,i,h){if(null!==t)return o(t);r(n._resolveModels(e,i).then((function(e){return s=e,{models:e,query:c}})))})),c.on("insert",(function(t){n._resolveModels(e,t).then((function(e){return s.addObjects(e)}))})),c.on("remove",(function(t){n._resolveModels(e,t).then((function(t){return _.forEach(t,(function(t){n.unload(e,t)})),s.removeObjects(t)}))}))}))}))},findRecord(e,t){const n=this,i=n.cache[k(e)];return z.create({promise:new S((function(r,o){try{var s=i[0].doc.id==t&&1==i.length}catch(e){}s?r(i[0]):n.findQuery(e,{_id:t}).then((function(e){r(e[0])})).catch((function(e){o(e)}))}))})},findQuery(e,t){let n,i;i=(n=this._getPathForType(e))?n:k(e),i=this._getPrefix(e)+i;const r=this;return this.checkConnection().then((function(){return new S((function(n,o){r.connection.createFetchQuery(i,t,null,(function(t,i,s){if(null!==t)return o(t);n(r._resolveModels(e,i))}))}))}))},findAll(e,t){throw e=k(e),new Error("findAll not implemented")},_cacheFor(e){e=k(e);let t=this.cache[e];return void 0===t&&(this.cache[e]=t=[]),t},_getPathForType(e){const t=Ember.getOwner(this).lookup(`adapter:${A(e)}`);if(t&&t.pathForType)return t.pathForType(e)},_getPrefix(e){const t=Ember.getOwner(this).lookup(`adapter:${A(e)}`);let n;return t&&(n=t.get("prefix")),n||(n=""),n},_factoryFor(e){let t;const n=(t=this.get("modelStr"))?t:"model-sdb";return Ember.getOwner(this).factoryFor(`${n}:${A(e)}`)},_createModel(e,t){const n=this._factoryFor(e);if(n)return n.create({doc:t,_type:k(e),_store:this});throw new Error(`Cannot find model for ${e}`)},_resolveModel(e,t){const n=this._cacheFor(k(e)),i=Ember.get(t,"id")||Ember.get(t,"_id"),r=n.findBy("id",i);if(void 0!==r)return S.resolve(r);const o=this;return o.subscribe(t).then((function(t){return o._createModel(e,t)}))},_resolveModels(e,t){const n=this._cacheFor(k(e)),i=[],r=[];for(let o=0;o<t.length;o++){const s=t[o],c=n.findBy("id",s.id);c?i.push(c):r.push(this._resolveModel(e,s))}return new S((function(e,t){Ember.isEmpty(r)?e(i):S.all(r).then((function(t){n.addObjects(t),e(i.concat(t))})).catch((function(e){t(e)}))}))},whenReady:e=>"ready"===e.state?S.resolve(e):new S((function(t,n){e.on("load",(function(){Ember.run(null,t,e)}))})),unloadRecord(e,t){const n=this.cache[e.get("_type")];return e.get("doc").destroy((()=>{if(n.removeObject(e),e.destroy(),"function"==typeof t)return t()})),this},unload(e,t){e=k(e);const n=this._cacheFor(e);try{t.get("doc").destroy((()=>{n.removeObject(t),t.destroy()}))}catch(e){}t.destroy(),n.removeObject(t)},unloadAll(e){return new S(((t,n)=>{const i=this.cache[k(e)]||[],r=i.map((e=>new S((t=>{e.get("doc").destroy((()=>{e.destroy(),t()}))}))));return S.all(r).then((()=>{i.removeObjects(i),t()})).catch(n)}))},peekAll(e){return e=k(e),this._cacheFor(e)},subscribe:e=>e.subscribed?S.resolve(e):new S((function(t,n){e.subscribe((function(i){void 0===i?Ember.run(null,t,e):Ember.run(null,n,i)}))})),create:(e,t)=>new S((function(n,i){e.create(t,"json0",(function(t){void 0===t?Ember.run(null,n,e):Ember.run(null,i,t)}))}))}),{belongsToShare(e,t){const n=this.ShareStore;return Ember.computed({get(e){return n.findRecord(t,this.get(`doc.data.${e}`))},set:(e,t,n)=>t})},belongsTo(e,t){const n=this.originalStore;return Ember.computed({get(e){let i;return n.findRecord(t,this.get(i=`doc.data.${e}`))},set:(e,t,n)=>t})}}),{belongsTo:M}=L,{belongsToShare:D}=L;a("_sdbProps")})();